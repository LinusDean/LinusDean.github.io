<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Use Systemd in Docker Container | Dean&#39;s Blog</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Blog</a></li>
      
      <li><a href="/categories">Categories</a></li>
      
      <li><a href="/tags">Tags</a></li>
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/blogroll">Blogroll</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Use Systemd in Docker Container</span></h1>

<h2 class="date">2021/08/03</h2>
</div>

<main>
<h1 id="use-systemd-in-docker-container">Use systemd in docker container</h1>
<p>å…¬å¸çš„ä»£ç æ¯”è¾ƒè€æ—§åŠ ä¸Šä½¿ç”¨çš„gccç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒä½ï¼Œæˆ‘æ”¾å¼ƒäº†åœ¨macOSä¸Šç›´æ¥å¼€å‘ï¼Œä¹‹å‰åœ¨è‡ªå·±æ­å»ºçš„CentOS7è™šæ‹Ÿæœºä¸‹é¢æ­å»ºäº†ä¸€ä¸ªå¼€å‘ç¯å¢ƒï¼Œå…¶å®ç¯å¢ƒè¿˜æ˜¯å¾ˆOKçš„ï¼Œä½†æ˜¯è™šæ‹Ÿæœºæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿è¿ç§»ï¼Œä¸”æ¯”è¾ƒç¬¨é‡ï¼Œäºæ˜¯æˆ‘æƒ³ç€èƒ½ä¸èƒ½å°†å¼€å‘ç¯å¢ƒå®¹å™¨åŒ–ï¼Œäºæ˜¯é‡åˆ°systemdåœ¨dockerä¸‹é¢çš„é—®é¢˜ï¼Œä¾¿è®°å½•ä¸‹æ¥ã€‚</p>
<h1 id="solution">Solution</h1>
<p>é€šè¿‡ä¸æ–­çš„Googleï¼Œæˆ‘ç»ˆäºæˆåŠŸçš„åœ¨CentOS7çš„containerä¸‹é¢ç”¨èµ·äº†systemdå’Œccls, é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸‹é¢çš„Dockerfile</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#719e07">FROM</span><span style="color:#2aa198"> centos:7</span>
<span style="color:#719e07">ENV</span> container docker
<span style="color:#719e07">RUN</span> yum -y install systemd; yum clean all;
<span style="color:#719e07">RUN</span> <span style="color:#719e07">(</span><span style="color:#b58900">cd</span> /lib/systemd/system/sysinit.target.wants/; <span style="color:#719e07">for</span> i in ; <span style="color:#719e07">do</span> <span style="color:#719e07">[</span> <span style="color:#268bd2">$i</span> <span style="color:#719e07">==</span> systemd-tmpfiles-setup.service <span style="color:#719e07">]</span> <span style="color:#719e07">||</span> rm -f <span style="color:#268bd2">$i</span>; <span style="color:#719e07">done</span><span style="color:#719e07">)</span>;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/multi-user.target.wants/;
<span style="color:#719e07">RUN</span> rm -rf /etc/systemd/system/.wants/;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/local-fs.target.wants/;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/sockets.target.wants/udev;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/sockets.target.wants/initctl;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/basic.target.wants/;
<span style="color:#719e07">RUN</span> rm -rf /lib/systemd/system/anaconda.target.wants/*;
<span style="color:#719e07">VOLUME</span> [ <span style="color:#2aa198">&#34;/sys/fs/cgroup&#34;</span> ] 
<span style="color:#719e07">RUN</span> yum -y install gcc
<span style="color:#719e07">RUN</span> yum -y install epel-release
<span style="color:#719e07">RUN</span> yum -y install snapd
<span style="color:#719e07">CMD</span> [<span style="color:#2aa198">&#34;/usr/sbin/init&#34;</span>]
</code></pre></div><p>åœ¨Dockerç›®å½•çš„åŒçº§ç›®å½•ä¸‹é¢æ‰§è¡Œdocker build -t dev .<br>
æˆ‘ä»¬åœ¨æ‰§è¡Œå®Œä¹‹åå»æ‰§è¡Œdocker run -itd &ndash;name container01 &ndash;privileged=true dev /sbin/init å¯åŠ¨å®¹å™¨<br>
ä½¿ç”¨docker exec -ti container01 bashè¿›å…¥å®¹å™¨çš„äº¤äº’shell,æ‰§è¡Œsystemctl status snapdå¦‚æœæ²¡æœ‰æŠ¥é”™é‚£ä¹ˆæ­å–œä½ ï¼ŒæˆåŠŸåœ°åœ¨å®¹å™¨ä¸‹é¢ä½¿ç”¨äº†systemd,å®‰è£…cclså¯ä»¥å‚è€ƒä¸‹å›¾ä¸­åœ°å‘½ä»¤
<img src="https://raw.githubusercontent.com/cyber-prog0x/cyber-prog0x.github.io/master/assets/systemd-in-docker-container.png" alt="&ldquo;systemd and ccls&rdquo;"></p>

</main>
<hr />
<h1>CommentsğŸ‰</h1>

<div id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="5b549074-8206-4098-983b-d54bb541397a"
  data-page-id="29c4ea12db9f6e21906c27a0ed3de259"
  data-page-url="https://treeboylife.com/blog/use-systemd-in-docker-container/"
  data-page-title="Use Systemd in Docker Container"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>
  <footer>
  
  
  <hr/>
  Â© <a href="https://treeboylife.com">Nan Dean</a> 2016 &ndash; 2021
  
  </footer>
  </body>
</html>

