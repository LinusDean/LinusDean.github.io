<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Iptables Port Forwarding Settings | Dean&#39;s Blog</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Blog</a></li>
      
      <li><a href="/categories">Categories</a></li>
      
      <li><a href="/tags">Tags</a></li>
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/blogroll">Blogroll</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Iptables Port Forwarding Settings</span></h1>

<h2 class="date">2021/08/02</h2>
</div>

<main>
<h1 id="linux-iptables转发">Linux iptables转发</h1>
<p>最近在使用Apsara专有云，但是其安全组策略有一些限制，原本我们需要使用A机器访问C机器，可惜目前A机器因为安全组策略的原因无法正常访问，但凑巧的是目前有一台中转节点B，A可以访问B，B也可以访问C<br>
于是我想起了之前Linux用iptables做端口转发的，这边简单记录一下</p>
<h2 id="示意图">示意图</h2>
<p>目前简单的网络架构是这样子的<br>
<img src="https://raw.githubusercontent.com/cyber-prog0x/cyber-prog0x.github.io/master/assets/ip-forwarding-network.png" alt="&ldquo;network&rdquo;">
我们首先需要在服务器B上面开启端口转发功能，需要给sysctl.conf写入端口转发配置</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">net.ipv4.ip_forward<span style="color:#719e07">=</span><span style="color:#2aa198">1</span>
</code></pre></div><p>执行sysctl -p使其生效，最后配置iptables</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#2aa198">8080</span> -j DNAT --to-destination 1.1.1.1:8080
iptables -t nat -A POSTROUTING -p tcp -d 1.1.1.1 --dport <span style="color:#2aa198">8080</span> -j SNAT --to-source 192.168.2.1 
</code></pre></div><p>这样子我们就可以服务器A访问服务器B的8080端口实现访问服务器C的8080端口效果</p>

</main>
<hr />
<h1>Comments🎉</h1>

<div id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="5b549074-8206-4098-983b-d54bb541397a"
  data-page-id="5e16a066ef80f0e91d047baeb7a254b2"
  data-page-url="https://treeboylife.com/blog/iptables-port-forwarding-settings/"
  data-page-title="Iptables Port Forwarding Settings"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>
  <footer>
  
  
  <hr/>
  © <a href="https://treeboylife.com">Nan Dean</a> 2016 &ndash; 2021
  
  </footer>
  </body>
</html>

